<!--
  مشروع موقع تواصل اجتماعي متكامل يشبه Instagram/Facebook، يتضمن:
  - تسجيل الدخول وإنشاء حساب
  - صلاحيات خاصة لحساب ZERO
  - منشورات تحتوي على نصوص وصور، لايكات وتعليقات
  - شات خاص، طلبات صداقة، إشعارات
  - عرض الملف الشخصي وتعديله (الاسم، الصورة، الباسورد)
  - بحث عن مستخدمين
  - دعم الوضع الداكن
  - تخزين البيانات محليًا (localStorage)
  - تصميم أسطوري فخم أسود + لبني
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Social Media Legend</title>
  <style>
    /* الأساسيات */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0e0e10;
      color: #fff;
    }
    .container {
      max-width: 500px;
      margin: auto;
      padding: 20px;
    }
    input, button, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 10px;
      border: none;
      font-size: 1em;
    }
    button {
      background-color: #00acee;
      color: white;
      cursor: pointer;
    }
    .hidden { display: none; }
    .profile-pic {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin: 10px auto;
      display: block;
    }
    .post, .comment {
      background: #1a1a1a;
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
    }
    .post img {
      width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
    .btn-row {
      display: flex;
      gap: 10px;
    }
    .chat-box, .search-result {
      background: #222;
      border-radius: 10px;
      padding: 10px;
      margin-top: 10px;
    }
    .nav-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #1a1a1a;
      display: flex;
      justify-content: space-around;
      padding: 10px;
      z-index: 999;
    }
    .nav-bar button {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <!-- سيتم توليد واجهة المستخدم كاملة بواسطة JavaScript -->
  </div>
  <div class="nav-bar">
    <button onclick="navigate('home')">منشورات</button>
    <button onclick="navigate('search')">بحث</button>
    <button onclick="navigate('chats')">شات</button>
    <button onclick="navigate('notifications')">إشعارات</button>
    <button onclick="navigate('settings')">الإعدادات</button>
  </div>
  <script>
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
    let posts = JSON.parse(localStorage.getItem('posts') || '[]');
    let friends = JSON.parse(localStorage.getItem('friends') || '[]');
    let chats = JSON.parse(localStorage.getItem('chats') || '[]');
    let page = 'login';

    function saveAll() {
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      localStorage.setItem('posts', JSON.stringify(posts));
      localStorage.setItem('friends', JSON.stringify(friends));
      localStorage.setItem('chats', JSON.stringify(chats));
    }

    function navigate(p) {
      page = p;
      render();
    }

    function render() {
      const app = document.getElementById('app');
      if (!currentUser && page !== 'register') return renderLogin();
      if (page === 'login') return renderLogin();
      if (page === 'register') return renderRegister();
      if (page === 'home') return renderHome();
      if (page === 'search') return renderSearch();
      if (page === 'chats') return renderChats();
      if (page === 'notifications') return renderNotifications();
      if (page === 'settings') return renderSettings();
    }

    function renderLogin() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h2>تسجيل دخول</h2>
        <input id="login-user" placeholder="اسم المستخدم" />
        <input id="login-pass" type="password" placeholder="كلمة المرور" />
        <button onclick="login()">دخول</button>
        <p>لا تملك حساب؟ <a href="#" onclick="navigate('register')">أنشئ حساب</a></p>
      `;
    }

    function renderRegister() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h2>إنشاء حساب</h2>
        <input id="reg-user" placeholder="اسم المستخدم" />
        <input id="reg-pass" type="password" placeholder="كلمة المرور" />
        <input id="reg-pic" type="file" accept="image/*" onchange="previewImage(event, 'reg-preview')" />
        <img id="reg-preview" class="profile-pic" src="" />
        <button onclick="register()">إنشاء</button>
        <p>هل لديك حساب؟ <a href="#" onclick="navigate('login')">تسجيل دخول</a></p>
      `;
    }

    function previewImage(event, id) {
      const output = document.getElementById(id);
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = () => output.src = reader.result;
      reader.readAsDataURL(file);
    }

    function login() {
      const user = document.getElementById('login-user').value;
      const pass = document.getElementById('login-pass').value;
      if (users[user] && users[user].password === pass) {
        currentUser = users[user];
        currentUser.username = user;
        saveAll();
        navigate('home');
      } else alert("بيانات غير صحيحة");
    }

    function register() {
      const user = document.getElementById('reg-user').value;
      const pass = document.getElementById('reg-pass').value;
      const img = document.getElementById('reg-preview').src;
      if (!user || !pass) return alert("املأ كل الحقول");
      if (users[user]) return alert("اسم المستخدم مستخدم بالفعل");
      users[user] = { password: pass, pic: img };
      saveAll();
      alert("تم إنشاء الحساب");
      navigate('login');
    }

    function renderHome() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h2>مرحبا ${currentUser.username}</h2>
        <textarea id="new-post" placeholder="ماذا تفكر؟"></textarea>
        <input id="post-image" type="file" accept="image/*" onchange="previewImage(event, 'post-preview')" />
        <img id="post-preview" src="" class="profile-pic" />
        <button onclick="createPost()">نشر</button>
        ${posts.map(post => `
          <div class="post">
            <b>${post.user}</b>
            <p>${post.text}</p>
            ${post.image ? `<img src="${post.image}" />` : ''}
            <div class="btn-row">
              <button onclick="toggleComments('${post.id}')">💬 تعليقات</button>
              ${post.user === currentUser.username ? `<button onclick="deletePost('${post.id}')">🗑 حذف</button>` : ''}
            </div>
            <div id="comments-${post.id}" class="hidden">
              ${(post.comments || []).map(c => `<div class="comment">${c.user}: ${c.text}</div>`).join('')}
              <input placeholder="اكتب تعليق..." onkeydown="if(event.key==='Enter') addComment('${post.id}', this.value)" />
            </div>
          </div>
        `).join('')}
      `;
    }

    function createPost() {
      const text = document.getElementById('new-post').value;
      const img = document.getElementById('post-preview').src;
      if (!text && img === '') return;
      posts.unshift({ id: Date.now()+"", user: currentUser.username, text, image: img !== '' ? img : null, comments: [] });
      saveAll();
      render();
    }

    function deletePost(id) {
      posts = posts.filter(p => p.id !== id);
      saveAll();
      render();
    }

    function toggleComments(id) {
      const el = document.getElementById('comments-' + id);
      el.classList.toggle('hidden');
    }

    function addComment(postId, text) {
      const post = posts.find(p => p.id === postId);
      if (!post.comments) post.comments = [];
      post.comments.push({ user: currentUser.username, text });
      saveAll();
      render();
    }

    function renderSearch() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <h2>بحث عن مستخدم</h2>
        <input id="search-input" placeholder="اكتب اسم المستخدم..." oninput="doSearch(this.value)" />
        <div id="search-results"></div>
      `;
    }

    function doSearch(query) {
      const resultBox = document.getElementById('search-results');
      const found = Object.keys(users).filter(u => u.includes(query));
      resultBox.innerHTML = found.map(u => `
        <div class="search-result">
          <img src="${users[u].pic}" class="profile-pic" />
          <b>${u}</b>
          <button onclick="startChat('${u}')">شات</button>
        </div>
      `).join('');
    }

    function startChat(username) {
      alert("فتح شات مع " + username);
    }

    function renderChats() {
      document.getElementById('app').innerHTML = '<h2>قريبًا: الشات</h2>';
    }

    function renderNotifications() {
      document.getElementById('app').innerHTML = '<h2>قريبًا: الإشعارات</h2>';
    }

    function renderSettings() {
      document.getElementById('app').innerHTML = `
        <h2>الإعدادات</h2>
        <input placeholder="الاسم الجديد" id="new-name" />
        <input placeholder="كلمة المرور الجديدة" id="new-pass" />
        <input type="file" accept="image/*" onchange="previewImage(event, 'profile-preview')" />
        <img id="profile-preview" src="${currentUser.pic}" class="profile-pic" />
        <button onclick="saveProfile()">حفظ التعديلات</button>
      `;
    }

    function saveProfile() {
      const name = document.getElementById('new-name').value;
      const pass = document.getElementById('new-pass').value;
      const pic = document.getElementById('profile-preview').src;
      if (name) users[currentUser.username].username = name;
      if (pass) users[currentUser.username].password = pass;
      if (pic) users[currentUser.username].pic = pic;
      currentUser.pic = pic;
      saveAll();
      alert("تم التحديث بنجاح");
    }

    render();
  </script>
</body>
</html>
